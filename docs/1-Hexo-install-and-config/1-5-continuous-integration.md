---
title: æŒç»­é›†æˆ
sidebarDepth: 4
---

# æŒç»­é›†æˆ Continous Integration

:::tip
åˆ©ç”¨ Travis CI å°† Hexo æŒç»­é›†æˆéƒ¨ç½²åˆ° GitHub Pages. ğŸ‘·
:::

## ä»€ä¹ˆæ˜¯æŒç»­é›†æˆï¼Ÿ

> æŒç»­é›†æˆï¼ˆè‹±è¯­ï¼šContinuous integrationï¼Œç¼©å†™ CIï¼‰æ˜¯ä¸€ç§è½¯ä»¶å·¥ç¨‹æµç¨‹ï¼Œæ˜¯å°†æ‰€æœ‰è½¯ä»¶å·¥ç¨‹å¸ˆå¯¹äºè½¯ä»¶çš„å·¥ä½œå‰¯æœ¬æŒç»­é›†æˆåˆ°å…±äº«ä¸»çº¿ï¼ˆmainlineï¼‰çš„ä¸€ç§ä¸¾æªã€‚

ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬é€šè¿‡æŒç»­é›†æˆï¼Œèƒ½å¤Ÿç®€åŒ– Hexo å‘å¸ƒåšå®¢çš„æ­¥éª¤ï¼Œå³ï¼šå°†æ¸…é™¤ç¼“å­˜ `hexo clean`ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶ `hexo generate` å’Œéƒ¨ç½²åˆ° GitHub Pages `hexo deploy` è¿™äº›æ­¥éª¤é€šè¿‡æŒç»­é›†æˆå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨æ‰§è¡Œã€‚

è¿™æ ·æˆ‘ä»¬åœ¨æœ¬åœ°å¯¹åšå®¢æ–‡ä»¶è¿›è¡Œä¿®æ”¹ã€æ–°å¢åšæ–‡å†…å®¹æˆ–è€…æ–°å¢åšå®¢æ–‡ç« ï¼Œåªéœ€è¦é€šè¿‡ `git` æ¨é€åˆ° GitHub ä»“åº“ä¹‹åï¼ŒæŒç»­é›†æˆå·¥å…·å°±å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨çº¿æ„å»ºåšå®¢é™æ€æ–‡ä»¶å¹¶ç›´æ¥éƒ¨ç½²åˆ° GitHub Pagesã€‚è¿™ä¹‹åï¼Œæˆ‘ä»¬å‘å¸ƒåšå®¢å†…å®¹å°±ä¸éœ€è¦æœ¬åœ°ä¸‰æ­¥èµ°äº†ã€‚

**ğŸ‘· æœ¬ç« æˆ‘ä»¬æ‰€åˆ©ç”¨çš„æŒç»­é›†æˆå¹³å°æ˜¯ Travis CI.**

## æ³¨å†Œ Travis CI è´¦å·ï¼Œç»‘å®š GitHub è´¦æˆ·

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ° [Travis CI](https://travis-ci.org/) å®˜ç½‘ï¼Œç”¨è‡ªå·±çš„ GitHub è´¦æˆ·ç›´æ¥å…³è”ç™»å½•ï¼Œå¹¶å…è®¸ Travis CI æŸ¥çœ‹è‡ªå·±çš„å…¬æœ‰ä»“åº“ã€‚

ç„¶åæˆ‘ä»¬åˆ° [Travis CI è´¦æˆ·é¡µé¢](https://travis-ci.org/account/repositories) å¼€å¯æˆ‘ä»¬çš„åšå®¢ä»“åº“ã€‚å¦‚å›¾ã€‚

![](https://i.loli.net/2018/10/24/5bd00b108798c.png)

## é…ç½®æ–‡ä»¶

### é…ç½®æœ¬åœ°å’Œè¿œç¨‹ä»“åº“

:::warning
ç”±äº GitHub Pages çš„é™åˆ¶ï¼Œæ¯ä¸ªäººçš„é»˜è®¤åšå®¢ä»“åº“ `xxx.github.io` åªå…è®¸å°†é™æ€æ–‡ä»¶æ‰˜ç®¡åœ¨ä»“åº“çš„ master åˆ†æ”¯ã€‚
:::

ä¸ºäº†æ–¹ä¾¿ä¸‹é¢æ­¥éª¤çš„è¿›è¡Œï¼Œæˆ‘ä»¬è¿›è¡Œè¿™æ ·çš„é…ç½®ï¼š

- å¤‡ä»½åšå®¢æºæ–‡ä»¶
- åœ¨æœ¬åœ°ä»“åº“åˆ›å»º `hexo` åˆ†æ”¯

```bash
# å…‹éš†é¡¹ç›®åˆ°æœ¬åœ°
git clone https://github.com/xxx/xxx.github.io.git
# åˆ›å»ºå¹¶åˆ‡æ¢åˆ° hexo åˆ†æ”¯
git checkout -b hexo
```

- åœ¨ `hexo` åˆ†æ”¯ä¿å­˜åšå®¢é¡¹ç›®çš„æºä»£ç 
    - å°† `hexo` åˆ†æ”¯ä¸‹çš„æ–‡ä»¶é™¤ `.git` ç›®å½•å¤–å…¨éƒ¨åˆ é™¤
    - å°†åšå®¢æºç æ–‡ä»¶æ‹·è´åˆ°è¯¥ç›®å½•ä¸‹ï¼Œå¹¶æäº¤ Commit åˆ° `hexo` åˆ†æ”¯.
- å°†æœ¬åœ° `hexo` åˆ†æ”¯å†…å®¹æäº¤åˆ° GitHub è¿œç¨‹ä»“åº“

```bash
# æäº¤æœ¬åœ° hexo åˆ†æ”¯åˆ°è¿œç¨‹ä»“åº“çš„ hexo åˆ†æ”¯
git push origin hexo:hexo
```

ç»è¿‡è¿™æ ·çš„é…ç½®ï¼Œæˆ‘ä»¬åšå®¢ä»“åº“é¡¹ç›®æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š

- åœ¨ `hexo` åˆ†æ”¯ä¿å­˜åšå®¢é¡¹ç›®çš„æºä»£ç 
- åœ¨ `master` åˆ†æ”¯ä¿æŒé¡¹ç›®çš„é™æ€æ–‡ä»¶ï¼ˆå³ `public` æ–‡ä»¶å¤¹ä¸‹çš„å†…å®¹ï¼‰

### é…ç½®æŒç»­é›†æˆæ–‡ä»¶

`.travis.yml` æ˜¯ Travis CI çš„éƒ¨ç½²é…ç½®æ–‡ä»¶ï¼ŒTravis CI éƒ¨ç½²æ—¶ä¼šè‡ªåŠ¨è¯»å–æˆ‘ä»¬æ¯æ¬¡ Commit ä¸­æ˜¯å¦åŒ…å« `.travis.yml`ï¼Œæœ‰æ­¤æ–‡ä»¶æ‰ä¼šå¼€å§‹éƒ¨ç½²ã€‚

#### åˆ›å»º `.travis.yml` é…ç½®æ–‡ä»¶

åœ¨åšå®¢é¡¹ç›®æºä»£ç åˆ†æ”¯ä¸‹ï¼ˆ`hexo` åˆ†æ”¯ï¼‰åˆ›å»ºæ–‡ä»¶ `.travis.yml`ï¼Œå¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š

```yaml
language: node_js

sudo: required

node_js: stable

install:
  - npm install

branches:
  only:
    - hexo

before_install: 
  - export TZ='Asia/Shanghai'
  - npm install hexo-cli -g

install:
  - npm install

script:
  - hexo clean
  - hexo generate

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GITHUB_TOKEN
  local_dir: public
  name: $GIT_NAME
  email: $GIT_EMAIL
  keep-history: true
  target-branch: master
  on:
    branch: hexo
```

è§£é‡Šä¸€ä¸‹ï¼š

- `language`ï¼šç¼–è¯‘è¯­è¨€ã€ç¯å¢ƒï¼›`node_js`ï¼šNode.js ç‰ˆæœ¬ï¼›`sudo`ï¼šéœ€è¦ç®¡ç†å‘˜æƒé™ï¼›
- `install`ï¼šå®‰è£…ç¯å¢ƒ npmï¼›
- `branches`ï¼šå·¥ä½œä»“åº“åˆ†æ”¯ï¼ˆhexo åˆ†æ”¯ï¼‰ï¼›
- `before_install`ï¼šé…ç½®æ—¶åŒºä¸ºä¸­å›½æ—¶åŒºä¸œå…«åŒºï¼ˆUTC + 8ï¼‰ï¼Œå®‰è£…ç»„ä»¶ `hexo`ï¼›
- `install`ï¼šå®‰è£…ä¾èµ– `npm install`ï¼›
- `script`ï¼šæ‰§è¡Œè„šæœ¬ï¼Œæ¸…é™¤ç¼“å­˜ï¼Œç”Ÿæˆé™æ€æ–‡ä»¶å¹¶æ”¾åœ¨ `public` æ–‡ä»¶å¤¹ä¸‹ï¼›
- `deploy`ï¼šæ‰§è¡Œéƒ¨ç½²ã€‚

:::warning
- å…¶ä»–æ–‡æ¡£å¯èƒ½æåˆ°äº†åˆ©ç”¨ `hexo-deployer-git` è¿›è¡Œéƒ¨ç½²ï¼Œä½†æ˜¯ç”±äº Travis CI æœ¬èº«æ”¯æŒç›´æ¥éƒ¨ç½²åˆ° GitHub Pages çš„å·¥å…·ï¼Œå› æ­¤æ— éœ€å¦è¡Œå®‰è£… `hexo-deployer-git` äº†ï¼›
- å…¶ä»–æ–‡æ¡£ä¹Ÿå¯èƒ½æåˆ°åœ¨ `.travis.yml` ä¸­åŠ å…¥å¦‚ä¸‹å†…å®¹ï¼Œæ¥ç¼“å­˜ `node_modules` ä¸‹çš„å†…å®¹ï¼Œä»è€ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ã€‚ä½†æ˜¯ç»è¿‡æˆ‘çš„å°è¯•ï¼Œ`node_modules` ç»å¸¸ä¼šç”±äºæ²¡æœ‰åŠæ—¶æ›´æ–°ï¼Œåœ¨æ·»åŠ å…¶ä»–ç»„ä»¶ä¹‹åå‡ºç°ã€Œåšå®¢ç”Ÿæˆé™æ€æ–‡ä»¶æ­¥éª¤ã€å¤±è´¥çš„æƒ…å†µï¼Œå› æ­¤å»ºè®®ä¸è¿›è¡Œç¼“å­˜å¤„ç†ã€‚

```yaml
cache:
  directories:
    - node_modules
```
:::

#### åœ¨ Travis CI ä¸­é…ç½®å˜é‡

åœ¨é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬ä½¿ç”¨äº†ä¸‰ä¸ªå˜é‡ï¼š

- `$GIT_NAME`ï¼š`git` ç”¨æˆ·å
- `$GIT_EMAIL`ï¼š`git` ç”¨æˆ·é‚®ç®±
- `$GITHUB_TOKEN`ï¼šGitHub é€šè¡Œè¯ (token) å­—ç¬¦ä¸²

å…¶ä¸­å‰ä¸¤é¡¹å¯ä»¥é€šè¿‡åœ¨æœ¬åœ°ç»ˆç«¯ä¸­è¿™æ ·æŸ¥çœ‹ï¼š

```bash
git config --global user.name
git config --global user.email
```

å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://i.loli.net/2018/10/24/5bd013ad92130.png)

æœ€åä¸€é¡¹ GitHub é€šè¡Œè¯ (token) æˆ‘ä»¬åœ¨ GitHub ä¸­è¿›è¡Œç”³è¯·ï¼š

- è®¿é—® [GitHub è´¦æˆ·è®¾ç½® > Tokens](https://github.com/settings/tokens)
- ç”Ÿæˆæ–° Token: Generate new token
- å¡«å…¥ Token æè¿°ï¼Œå¹¶ç»™äºˆ Token ç¬¬ä¸€é¡¹ `repo` çš„å…¨éƒ¨æƒé™

![](https://i.loli.net/2018/10/24/5bd014fd243f0.png)

- å°†ç”Ÿæˆçš„ Token å¤åˆ¶ï¼Œä¿å­˜ï¼ˆç”Ÿæˆ Token çš„é¡µé¢åªæœ‰ä¸€æ¬¡æœºä¼šçœ‹è§ï¼Œè¯·ä¿å­˜å¦¥å½“ã€‚ï¼‰

åœ¨ Travis CI ä»“åº“é…ç½®ä¸­ï¼Œå°†ä¸‰ä¸ªå˜é‡å¡«å…¥è®¾ç½®ï¼ˆä½äº `Settings > Environment Variables` å¤„å¹¶ä¿å­˜ï¼š

![](https://i.loli.net/2018/10/24/5bd016366df7f.png)

## è‡ªåŠ¨éƒ¨ç½²

ç»è¿‡ä»¥ä¸Šæ­¥éª¤çš„é…ç½®ï¼Œå‘å¸ƒåšå®¢çš„å‘½ä»¤å°±å˜æ›´ä¸ºï¼š

```bash
# åˆ‡æ¢åˆ° hexo åˆ†æ”¯
git checkout hexo

# æäº¤æ–°åšæ–‡
git add .
git commit -m "Publish new post."

# æ¨é€åˆ°è¿œç¨‹ä»“åº“
git push
```

è¿™æ ·ï¼Œåœ¨æ¯æ¬¡æˆ‘ä»¬å°†åšå®¢çš„æºæ–‡ä»¶é€šè¿‡ `git` æ¨é€åˆ° GitHub çš„ `hexo` åˆ†æ”¯ä¸Šåï¼ŒTravis CI å°±ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶ä¸»åŠ¨å¼€å§‹æ„å»ºæˆ‘ä»¬çš„åšå®¢é™æ€æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨éƒ¨ç½²åˆ° GitHub Pages ä¸­ã€‚

é™¤äº†æ–¹ä¾¿éƒ¨ç½²ï¼Œæˆ‘ä»¬åŒæ—¶è¿˜åœ¨ GitHub ä¸Šé¢æˆåŠŸå¼€å¯äº†æˆ‘ä»¬åšå®¢æºä»£ç çš„å¤‡ä»½ï¼Œä¸€ç®­åŒé›•ã€‚

## å‚è€ƒèµ„æ–™

- [æŒç»­é›†æˆ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/%E6%8C%81%E7%BA%8C%E6%95%B4%E5%90%88)
- [itfanr - ä½¿ç”¨ Travis CI è‡ªåŠ¨éƒ¨ç½² Hexo åšå®¢](https://www.itfanr.cc/2017/08/09/using-travis-ci-automatic-deploy-hexo-blogs/)
